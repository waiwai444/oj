Just use a stack to simulate the process. My code ran in uva in 0.079s.

Same problem:
	poj 1363